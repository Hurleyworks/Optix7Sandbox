// This header file was auto-generated by ClassMate++
// Created: 18 Aug 2019 4:00:14 pm
// Copyright (c) 2019, HurleyWorks

#pragma once

using juce::String;

class OptixEngine
{
 public:
	OptixEngine (const PropertyService& properties);
	~OptixEngine ();

	void init(const OptixConfig& config, CameraHandle& camera);
	void render(CameraHandle& camera)
	{
		renderer.render(camera, gas_handle, pipeline, sbt);
	}

 private:
	PropertyService properties;
	OptixRenderer renderer;
	ContextHandle context = nullptr;
	OptixModule module = nullptr;
	OptixPipeline pipeline = nullptr;
	OptixShaderBindingTable sbt = {};
	OptixTraversableHandle gas_handle = 0;
	
	char log[2048]; // For error reporting from OptiX creation functions
	size_t sizeof_log = sizeof(log);

	OptixProgramGroup raygen_prog_group = nullptr;
	OptixProgramGroup miss_prog_group = nullptr;
	OptixProgramGroup hitgroup_prog_group = nullptr;

	void createAccelerationStructure(const OptixConfig& config);
	void createModule(const OptixConfig& config, const String& ptxStr);
	void createProgramGroups(const OptixConfig& config);
	void linkPipeline(const OptixConfig& config);
	void setupShaderBindingTable(const OptixConfig& config, CameraHandle& camera);
	void updateCamera(const OptixConfig& config, CameraHandle& camera, RayGenSbtRecord & rg_sbt);

}; // end class OptixEngine
